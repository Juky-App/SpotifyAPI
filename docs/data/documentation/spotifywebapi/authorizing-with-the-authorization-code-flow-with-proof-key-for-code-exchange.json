{"identifier":{"url":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Authorizing-with-the-Authorization-Code-Flow-with-Proof-Key-for-Code-Exchange","interfaceLanguage":"swift"},"kind":"article","hierarchy":{"paths":[["doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI"]]},"primaryContentSections":[{"content":[{"text":"Authorization","type":"heading","anchor":"Authorization","level":2},{"inlineContent":[{"text":"Create an instance of ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/SpotifyAPI"},{"text":" and assign an instance of ","type":"text"},{"type":"reference","isActive":true,"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEManager"},{"type":"text","text":" to the "},{"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/SpotifyAPI\/authorizationManager","type":"reference","isActive":true},{"type":"text","text":" property:"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["import SpotifyWebAPI","","let spotify = SpotifyAPI(","    authorizationManager: AuthorizationCodeFlowPKCEManager(","        clientId: \"Your Client Id\"","    )",")"]},{"inlineContent":[{"type":"text","text":"Before each authentication request your app should generate a code verifier and a code challenge. The code verifier is a cryptographically random string between 43 and 128 characters in length. It can contain letters, digits, underscores, periods, hyphens, and tildes."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"In order to generate the code challenge, your app should hash the code verifier using the SHA256 algorithm. Then, ","type":"text"},{"identifier":"https:\/\/tools.ietf.org\/html\/rfc4648#section-5","isActive":true,"type":"reference"},{"type":"text","text":" encode the hash that you generated. "},{"inlineContent":[{"type":"text","text":"Do not include any"}],"type":"strong"},{"text":" ","type":"text"},{"code":"=","type":"codeVoice"},{"text":" ","type":"text"},{"type":"strong","inlineContent":[{"text":"padding characters","type":"text"}]},{"type":"text","text":" (percent-encoded or not)."}]},{"inlineContent":[{"type":"text","text":"You can use "},{"code":"String.randomURLSafe(length:using:)","type":"codeVoice"},{"type":"text","text":" or "},{"type":"codeVoice","code":"String.randomURLSafe(length:)"},{"type":"text","text":" to generate the code verifier. You can use the "},{"type":"codeVoice","code":"String.makeCodeChallenge(codeVerifier:)"},{"text":" method to create the code challenge from the code verifier.","type":"text"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"text":"For example:","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let codeVerifier = String.randomURLSafe(length: 128)","let codeChallenge = String.makeCodeChallenge(codeVerifier: codeVerifier)","","\/\/ optional, but strongly recommended","let state = String.randomURLSafe(length: 128)"]},{"inlineContent":[{"text":"If you use your own method to create these values, you can validate them using this ","type":"text"},{"identifier":"https:\/\/tonyxu-io.github.io\/pkce-generator\/","isActive":true,"type":"reference"},{"text":". See also ","type":"text"},{"type":"codeVoice","code":"Data.base64URLEncodedString()"},{"type":"text","text":" and "},{"type":"codeVoice","code":"String.urlSafeCharacters"},{"type":"text","text":"."}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Next, create the authorization URL that will be opened in a browser (or web view) using "},{"type":"reference","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEBackendManager\/makeAuthorizationURL(redirectURI:codeChallenge:state:scopes:)","isActive":true},{"text":". When opened, it displays a permissions dialog to the user. The user can then choose to either authorize or deny authorization for your application.","type":"text"}]},{"syntax":"swift","type":"codeListing","code":["let authorizationURL = spotify.authorizationManager.makeAuthorizationURL(","    redirectURI: URL(string: \"Your Redirect URI\")!,","    codeChallenge: codeChallenge,","    state: state,","    scopes: [","        .playlistModifyPrivate,","        .userModifyPlaybackState,","        .playlistReadCollaborative,","        .userReadPlaybackPosition","    ]",")!"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"The redirect URI needs to have been entered in the Redirect URI whitelist that you specified when you registered your application using the "},{"identifier":"https:\/\/developer.spotify.com\/dashboard\/login","isActive":true,"type":"reference"},{"text":". ","type":"text"},{"inlineContent":[{"type":"text","text":"DO NOT add a forward-slash to the end of the redirect URI."}],"type":"strong"}]},{"type":"paragraph","inlineContent":[{"text":"The documentation for each endpoint lists the ","type":"text"},{"type":"reference","isActive":true,"identifier":"https:\/\/developer.spotify.com\/documentation\/general\/guides\/authorization\/scopes\/"},{"type":"text","text":" that are required. You can always authorize your application again for different scopes, if necessary. However, this is not an additive process. You must specify all the scopes that you need each time you create the authorization URL."}]},{"type":"paragraph","inlineContent":[{"type":"text","text":"You can decide how to open the URL. If you are creating an iOS app, the simplest method is to use "},{"type":"codeVoice","code":"UIApplication.shared.open(authorizationURL)"},{"text":" to open the URL in the browser.","type":"text"}]},{"type":"paragraph","inlineContent":[{"text":"After the user either approves or denies authorization for your app, Spotify will redirect to the redirect URI that you specified when making the authorization URL with query parameters appended to it. Pass this URL into ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEBackendManager\/requestAccessAndRefreshTokens(redirectURIWithQuery:codeVerifier:state:)"},{"text":" to request the access and refresh tokens:","type":"text"}]},{"type":"codeListing","code":["spotify.authorizationManager.requestAccessAndRefreshTokens(","    redirectURIWithQuery: url,","    \/\/ Must match the code verifier that was used to generate the ","    \/\/ code challenge when creating the authorization URL.","    codeVerifier: codeVerifier,","    \/\/ Must match the value used when creating the authorization URL.","    state: state",")",".sink(receiveCompletion: { completion in","    switch completion {","        case .finished:","            print(\"successfully authorized\")","        case .failure(let error):","            if let authError = error as? SpotifyAuthorizationError, authError.accessWasDenied {","                print(\"The user denied the authorization request\")","            }","            else {","                print(\"couldn't authorize application: \\(error)\")","            }","    }","})",".store(in: &cancellables)"],"syntax":"swift"},{"inlineContent":[{"type":"text","text":"Once this publisher completes successfully, your application is authorized and you may begin making requests to the Spotify web API. "},{"type":"strong","inlineContent":[{"type":"text","text":"Ensure that you generate a new value for the state parameter, code verifier, and code challenge before making another authorization request"}]},{"text":". The access token will be refreshed automatically when necessary. For example:","type":"text"}],"type":"paragraph"},{"syntax":"swift","type":"codeListing","code":["import SpotifyExampleContent","","let playbackRequest = PlaybackRequest(","    context: .uris(","        URIs.Tracks.array(.faces, .illWind, .fearless)","    ),","    offset: .uri(URIs.Tracks.fearless),","    positionMS: 50_000",")","","spotify.play(playbackRequest)","    .sink(receiveCompletion: { completion in","        print(completion)","    })","    .store(in: &cancellables)"]},{"inlineContent":[{"type":"text","text":"Read more at the "},{"isActive":true,"identifier":"https:\/\/developer.spotify.com\/documentation\/general\/guides\/authorization\/code-flow\/","type":"reference"},{"text":".","type":"text"}],"type":"paragraph"}],"kind":"content"}],"metadata":{"modules":[{"name":"SpotifyWebAPI"}],"role":"article","roleHeading":"Article","title":"Authorizing with the Authorization Code Flow with Proof Key for Code Exchange"},"abstract":[{"text":"This is the best option for mobile and desktop applications where it is unsafe to store your client secret. It provides an additional layer of security compared to the Authorization Code Flow. Use this method if you need to access\/modify user data, which requires authorization scopes. It requires the user to login to their Spotify account in a browser\/web view and approve your app.","type":"text"}],"schemaVersion":{"minor":3,"patch":0,"major":0},"variants":[{"paths":["\/documentation\/spotifywebapi\/authorizing-with-the-authorization-code-flow-with-proof-key-for-code-exchange"],"traits":[{"interfaceLanguage":"swift"}]}],"seeAlsoSections":[{"identifiers":["doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEManager","doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowManager","doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Authorizing-with-the-Authorization-Code-Flow","doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/ClientCredentialsFlowManager","doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Authorizing-with-the-Client-Credentials-Flow","doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Scope","doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Additional-Authorization-Methods"],"generated":true,"title":"Authorization"}],"sections":[],"references":{"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/SpotifyAPI/authorizationManager":{"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/SpotifyAPI\/authorizationManager","role":"symbol","url":"\/documentation\/spotifywebapi\/spotifyapi\/authorizationmanager","type":"topic","kind":"symbol","abstract":[{"type":"text","text":"Manages the authorization process for your application and contains all the"},{"text":" ","type":"text"},{"text":"authorization information.","type":"text"}],"fragments":[{"kind":"keyword","text":"var"},{"text":" ","kind":"text"},{"text":"authorizationManager","kind":"identifier"},{"text":": ","kind":"text"},{"text":"AuthorizationManager","kind":"typeIdentifier"}],"title":"authorizationManager"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/Authorizing-with-the-Authorization-Code-Flow":{"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Authorizing-with-the-Authorization-Code-Flow","role":"article","url":"\/documentation\/spotifywebapi\/authorizing-with-the-authorization-code-flow","type":"topic","kind":"article","abstract":[{"text":"Use this method if you need to access\/modify user data, which requires authorization scopes. It requires the user to login to their Spotify account in a browser\/web view and approve your app.","type":"text"}],"title":"Authorizing with the Authorization Code Flow"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/SpotifyAPI":{"role":"symbol","navigatorTitle":[{"text":"SpotifyAPI","kind":"identifier"}],"fragments":[{"text":"class","kind":"keyword"},{"text":" ","kind":"text"},{"text":"SpotifyAPI","kind":"identifier"}],"url":"\/documentation\/spotifywebapi\/spotifyapi","title":"SpotifyAPI","abstract":[{"text":"The central class in this library. Provides methods for all of the Spotify web","type":"text"},{"text":" ","type":"text"},{"type":"text","text":"API endpoints and contains an authorization manager for managing the"},{"type":"text","text":" "},{"type":"text","text":"authorization process of your application."}],"kind":"symbol","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/SpotifyAPI","type":"topic"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/Scope":{"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Scope","url":"\/documentation\/spotifywebapi\/scope","abstract":[{"type":"text","text":"The Spotify authorization scopes."}],"navigatorTitle":[{"text":"Scope","kind":"identifier"}],"type":"topic","title":"Scope","kind":"symbol","role":"symbol","fragments":[{"text":"enum","kind":"keyword"},{"text":" ","kind":"text"},{"text":"Scope","kind":"identifier"}]},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/AuthorizationCodeFlowManager":{"url":"\/documentation\/spotifywebapi\/authorizationcodeflowmanager","fragments":[{"kind":"keyword","text":"class"},{"kind":"text","text":" "},{"kind":"identifier","text":"AuthorizationCodeFlowManager"}],"title":"AuthorizationCodeFlowManager","abstract":[{"text":"Manages the authorization process for the Authorization Code Flow.","type":"text"}],"kind":"symbol","navigatorTitle":[{"kind":"identifier","text":"AuthorizationCodeFlowManager"}],"type":"topic","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowManager","role":"symbol"},"https://developer.spotify.com/documentation/general/guides/authorization/code-flow/":{"titleInlineContent":[{"type":"text","text":"Spotify web API reference"}],"url":"https:\/\/developer.spotify.com\/documentation\/general\/guides\/authorization\/code-flow\/","title":"Spotify web API reference","identifier":"https:\/\/developer.spotify.com\/documentation\/general\/guides\/authorization\/code-flow\/","type":"link"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI":{"title":"SpotifyWebAPI","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI","url":"\/documentation\/spotifywebapi","role":"collection","type":"topic","kind":"symbol","abstract":[{"type":"text","text":"A Swift library for the Spotify web API"}]},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/AuthorizationCodeFlowPKCEManager":{"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEManager","role":"symbol","url":"\/documentation\/spotifywebapi\/authorizationcodeflowpkcemanager","type":"topic","navigatorTitle":[{"text":"AuthorizationCodeFlowPKCEManager","kind":"identifier"}],"kind":"symbol","abstract":[{"text":"Manages the authorization process for the Authorization Code Flow with Proof","type":"text"},{"text":" ","type":"text"},{"text":"Key for Code Exchange (PKCE).","type":"text"}],"fragments":[{"text":"class","kind":"keyword"},{"kind":"text","text":" "},{"text":"AuthorizationCodeFlowPKCEManager","kind":"identifier"}],"title":"AuthorizationCodeFlowPKCEManager"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/Additional-Authorization-Methods":{"kind":"article","url":"\/documentation\/spotifywebapi\/additional-authorization-methods","role":"collectionGroup","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Additional-Authorization-Methods","title":"Additional Authorization Methods","type":"topic","abstract":[{"type":"text","text":"Additional methods for authorizing your app with the Spotify web API."}]},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/AuthorizationCodeFlowPKCEBackendManager/makeAuthorizationURL(redirectURI:codeChallenge:state:scopes:)":{"kind":"symbol","type":"topic","fragments":[{"text":"func","kind":"keyword"},{"text":" ","kind":"text"},{"text":"makeAuthorizationURL","kind":"identifier"},{"text":"(","kind":"text"},{"kind":"externalParam","text":"redirectURI"},{"kind":"text","text":": "},{"preciseIdentifier":"s:10Foundation3URLV","text":"URL","kind":"typeIdentifier"},{"kind":"text","text":", "},{"text":"codeChallenge","kind":"externalParam"},{"text":": ","kind":"text"},{"preciseIdentifier":"s:SS","kind":"typeIdentifier","text":"String"},{"kind":"text","text":", "},{"text":"state","kind":"externalParam"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"text":"?, ","kind":"text"},{"text":"scopes","kind":"externalParam"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:Sh","text":"Set"},{"text":"<","kind":"text"},{"kind":"typeIdentifier","text":"Scope","preciseIdentifier":"s:13SpotifyWebAPI5ScopeO"},{"text":">) -> ","kind":"text"},{"text":"URL","preciseIdentifier":"s:10Foundation3URLV","kind":"typeIdentifier"},{"text":"?","kind":"text"}],"conformance":{"constraints":[{"type":"codeVoice","code":"Backend"},{"text":" conforms to ","type":"text"},{"type":"codeVoice","code":"AuthorizationCodeFlowPKCEBackend"},{"type":"text","text":"."}],"conformancePrefix":[{"type":"text","text":"Conforms when"}],"availabilityPrefix":[{"type":"text","text":"Available when"}]},"abstract":[{"type":"text","text":"The first step in the authorization process for the Authorization Code"},{"text":" ","type":"text"},{"type":"text","text":"Flow with Proof Key for Code Exchange."}],"url":"\/documentation\/spotifywebapi\/authorizationcodeflowpkcebackendmanager\/makeauthorizationurl(redirecturi:codechallenge:state:scopes:)","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEBackendManager\/makeAuthorizationURL(redirectURI:codeChallenge:state:scopes:)","title":"makeAuthorizationURL(redirectURI:codeChallenge:state:scopes:)","role":"symbol"},"https://developer.spotify.com/dashboard/login":{"type":"link","identifier":"https:\/\/developer.spotify.com\/dashboard\/login","title":"Spotify Developer Dashboard","url":"https:\/\/developer.spotify.com\/dashboard\/login","titleInlineContent":[{"type":"text","text":"Spotify Developer Dashboard"}]},"https://tools.ietf.org/html/rfc4648#section-5":{"titleInlineContent":[{"type":"text","text":"base64url"}],"url":"https:\/\/tools.ietf.org\/html\/rfc4648#section-5","title":"base64url","identifier":"https:\/\/tools.ietf.org\/html\/rfc4648#section-5","type":"link"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/AuthorizationCodeFlowPKCEBackendManager/requestAccessAndRefreshTokens(redirectURIWithQuery:codeVerifier:state:)":{"kind":"symbol","title":"requestAccessAndRefreshTokens(redirectURIWithQuery:codeVerifier:state:)","url":"\/documentation\/spotifywebapi\/authorizationcodeflowpkcebackendmanager\/requestaccessandrefreshtokens(redirecturiwithquery:codeverifier:state:)","type":"topic","fragments":[{"text":"func","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"requestAccessAndRefreshTokens"},{"text":"(","kind":"text"},{"text":"redirectURIWithQuery","kind":"externalParam"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:10Foundation3URLV","text":"URL"},{"text":", ","kind":"text"},{"kind":"externalParam","text":"codeVerifier"},{"text":": ","kind":"text"},{"text":"String","preciseIdentifier":"s:SS","kind":"typeIdentifier"},{"kind":"text","text":", "},{"text":"state","kind":"externalParam"},{"text":": ","kind":"text"},{"kind":"typeIdentifier","preciseIdentifier":"s:SS","text":"String"},{"text":"?) -> ","kind":"text"},{"text":"AnyPublisher","preciseIdentifier":"s:7Combine12AnyPublisherV","kind":"typeIdentifier"},{"text":"<","kind":"text"},{"text":"Void","kind":"typeIdentifier","preciseIdentifier":"s:s4Voida"},{"text":", any ","kind":"text"},{"text":"Error","kind":"typeIdentifier","preciseIdentifier":"s:s5ErrorP"},{"text":">","kind":"text"}],"conformance":{"availabilityPrefix":[{"type":"text","text":"Available when"}],"conformancePrefix":[{"type":"text","text":"Conforms when"}],"constraints":[{"type":"codeVoice","code":"Backend"},{"text":" conforms to ","type":"text"},{"code":"AuthorizationCodeFlowPKCEBackend","type":"codeVoice"},{"type":"text","text":"."}]},"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/AuthorizationCodeFlowPKCEBackendManager\/requestAccessAndRefreshTokens(redirectURIWithQuery:codeVerifier:state:)","abstract":[{"type":"text","text":"The second and final step in the authorization process for the"},{"type":"text","text":" "},{"type":"text","text":"Authorization Code Flow with Proof Key for Code Exchange."}],"role":"symbol"},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/ClientCredentialsFlowManager":{"identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/ClientCredentialsFlowManager","role":"symbol","url":"\/documentation\/spotifywebapi\/clientcredentialsflowmanager","type":"topic","navigatorTitle":[{"text":"ClientCredentialsFlowManager","kind":"identifier"}],"kind":"symbol","abstract":[{"text":"Manages the authorization process for the Client Credentials Flow.","type":"text"}],"fragments":[{"kind":"keyword","text":"class"},{"text":" ","kind":"text"},{"text":"ClientCredentialsFlowManager","kind":"identifier"}],"title":"ClientCredentialsFlowManager"},"https://tonyxu-io.github.io/pkce-generator/":{"identifier":"https:\/\/tonyxu-io.github.io\/pkce-generator\/","type":"link","title":"PKCE generator tool","titleInlineContent":[{"type":"text","text":"PKCE generator tool"}],"url":"https:\/\/tonyxu-io.github.io\/pkce-generator\/"},"https://developer.spotify.com/documentation/general/guides/authorization/scopes/":{"type":"link","title":"authorization scopes","identifier":"https:\/\/developer.spotify.com\/documentation\/general\/guides\/authorization\/scopes\/","url":"https:\/\/developer.spotify.com\/documentation\/general\/guides\/authorization\/scopes\/","titleInlineContent":[{"type":"text","text":"authorization scopes"}]},"doc://SpotifyWebAPI/documentation/SpotifyWebAPI/Authorizing-with-the-Client-Credentials-Flow":{"kind":"article","abstract":[{"type":"text","text":"Use this method if you do NOT need to access\/modify user data. In other words, you cannot access endpoints that require authorization scopes or an access token that was issued on behalf of a user. The advantage of this method is that it does not require any user interaction."}],"title":"Authorizing with the Client Credentials Flow","role":"article","type":"topic","url":"\/documentation\/spotifywebapi\/authorizing-with-the-client-credentials-flow","identifier":"doc:\/\/SpotifyWebAPI\/documentation\/SpotifyWebAPI\/Authorizing-with-the-Client-Credentials-Flow"}}}